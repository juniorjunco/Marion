<!DOCTYPE html>
<html lang="es">

<!-- HEAD -->
<head>
  <meta charset="UTF-8">

  <title>Admin</title>
  
  <meta http-equiv="cache-control" content="public"/> 
  <meta http-equiv="Pragma" content="public"/>  

  
  <meta name="Audience" content="ALL"/>
  <meta name="rating" content="general"/>
  <meta name="GOOGLEBOT" content="index,follow"/>
  <meta name="MSNBot" content="index,follow"/>
  <meta name="InktomiSlurp" content="index,follow"/>
  <meta name="Unknownrobot" content="index,follow"/>
  <meta name="Robots" content="index,follow"/>
  <meta name="revisit-after" content="1day"/>
  
  <meta name="theme-color" content="#151515" />
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no, shrink-to-fit=no">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

  <!-- SHARE TAGS -->
    <meta property="og:url" content="" />
  <meta property="og:title" content="Marion Ve" />
  
  <!-- //SHARE TAGS -->

  <!-- LAZYSIZES -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/lazysizes/5.3.2/lazysizes.min.js" integrity="sha512-q583ppKrCRc7N5O0n2nzUiJ+suUv7Et1JGels4bXOaMFQcamPk9HjdUknZuuFjBNs7tsMuadge5k9RzdmO+1GQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  
  <!-- FONTS -->
  <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,600,700" rel="stylesheet">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous">
  <link rel="icon" href="uploads/img/loja_logo/26/d78bdd4ff51bdfb1906e8fbc40038c13.png">
  <!-- CSS -->
  <link rel="stylesheet" href="/app/assets/dist/css/style.min.css?v=33">
  <link href="https://cdn.rawgit.com/michalsnik/aos/2.1.1/dist/aos.css" rel="stylesheet">
  <!-- Google Fonts -->
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">

<!-- AOS CSS -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/aos/2.3.4/aos.css" rel="stylesheet">


  <style>
    .slide-mask {
      top: initial;
      padding: 200px 20px 100px 20px;
      background: linear-gradient(to top, rgba(0,0,0,0.9), transparent);
    }
    .slide-mask h2 {
      color: #fff;
      font-weight: bold;
      font-size: 1.5rem;
    }
    @media screen and (max-width: 759px) {
      body {
        padding-top: 97px;
      }
      .menu-mobile ul li a:not(.rede):not(.header-langs-icon) {
        font-size: 18px;
      }
      .slide-mask {
        padding: 100px 20px 60px 20px;
      }
      .slide-mask h2 {
        font-size: 1.15rem;
      }
    }
    .modal-btn .btn::before { display: none; }
  </style>
  
  
  <link rel="shortcut icon" href=""/>

  <!-- Global site tag (gtag.js) - Google Analytics (ANTIGO) -->
  <!-- <script async src="https://www.googletagmanager.com/gtag/js?id=UA-171599834-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-171599834-1');
    gtag('config', 'G-TFQECVJPVG'); // topnode
  </script> -->

  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-NFKHPFH3GD"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-NFKHPFH3GD');
  </script>


</head>

<body>

  <!-- HEADER -->
  <header class="header-full">
    <div class="container">
      <div class="header-content">

        <!-- LOGO -->
        <a href="/index.html" title="Marion ve " class="header-logo colored-logo">
          <img src="/uploads/img/loja_logo/24/d14156b350ef35f7dbf1d4d2780182c4.png" alt="Marion ve">
        </a>
        <a href="/index.html" title="Marion ve" class="header-logo white-logo">
          <img src="/uploads/img/loja_logo/26/d78bdd4ff51bdfb1906e8fbc40038c13.png" alt="Marion ve">
        </a>

      <!-- DIREITA -->
      <div class="header-direita">
        <span class="menu-mobile-btn-wrap"></span>
        <!-- IDIOMAS -->
        <div class="header-langs">
          <div class="header-langs-icon">
              <img id="espaIcon" src="/app/thumbs-espa100.php" alt="Idioma">
          </div>
          <div class="header-langs-box">
              <a href="/index-en.html" class="header-langs-icon" title="English" onclick="changeLanguage('en')"><img src="/app/thumbs-ingles80.php" alt="En"></a>
              <a href="/index.html" class="header-langs-icon" title="Spanish" onclick="changeLanguage('es')"><img src="/app/thumbs-espa80.php" alt="Es"></a>
          </div>
      </div>
        <!-- //IDIOMAS -->

      </div>
      <!-- //DIREITA -->

    </div>
  </div>
</header>

<!-- MENU MOBILE -->
<!-- Botão menu mobile -->
<div id="menu-mobile-btn" class="menu-mobile-btn">
  <span></span>
  <span></span>
  <span></span>
</div>

<!-- Menu mobile -->
<div id="menu-mobile" class="menu-mobile-wrapper">
  <nav class="menu-mobile">
    <ul class="menu-mobile-nav">
      <li><a href="/index.html">Inicio</a></li>     
      <li><a href="/blog.html">Blog</a></li>     
      <li><a href="/biografia.html">Biografia</a></li>     
      <li><a href="corporativo.html">Corporativo</a></li>
      <li><a href="/proyectos.html">Proyectos</a></li>
      <li><a href="/admin.html">admin</a></li>     
      <li><a href="/news.html">News</a></li>     
      <li><a href="/contacto.html">Contacto</a></li>     
      <li>
        <div class="redes-sociais">
          <span>Redes sociales</span>
          <a href="https://www.instagram.com/marion.ve" target="_blank" class="rede" title="Instagram"><i class="fab fa-instagram"></i></a>
        </div>
      </li>
    </ul>
  </nav>
</div>
<!-- /.menu-mobile -->

  <!-- BANNER TÍTULO -->
  <section class="banner-titulo" style="background-image: url('/uploads/img/blog/blog-1.jpg');">
    <span class="mascara"></span>
    <div class="container">
      <h1 class="titulo" data-aos="fade-up">blog admin</h1>
    </div>
  </section>
  <!-- //BANNER TÍTULO -->

  <section class="admin-heading">
    <h1><span>Admin Dashboard</span></h1>
</section>

<section class="posts-container">
    <div class="profile-section" data-aos="fade-up">
        <div class="sticky-profile">
            <section>
                <h1 class="username-title">Username</h1>
                <h1 class="username-display"><span id="username"></span></h1>
                <button class="logout-btn" id="logoutButton">Logout</button>
            </section>
        </div>
    </div>
</section>
 

    <section class="post-section-p">
      <div class="">
        <div class="post-card" id="posts"></div>
          <h2  class="post-title"></h2>
          <p class="post-content"></p>
      </div>
    </section>


   <section class="secao">
    <section>
      <div class="container">
          <div id="posts"></div>
          <h2 class="subtitulo">New Post</h2>
          <form id="postForm">
            <div class="campo-container"><input class="campo" type="text" id="title" placeholder="Título" required></div>
            <div class="campo-container"><textarea class="campo" id="content" placeholder="Contenido" required></textarea></div>
            <div class="btn-container"><button class="btn btn-primario" type="submit">Publicar</button></div>
          </form>
        </div>
  </section>
  </section>





  <!-- //INSTITUCIONAL -->

  <!-- INSTAGRAM -->
  
  <!-- FOOTER -->
  <!-- <div class="divider bottom left divider-footer">
  <span></span>
</div> -->

<!-- FOOTER -->
<footer class="footer">
	<div class="container">
    <div class="footer-content">

      <!-- LOGO -->
      <div class="footer-bloco footer-logo">

        <a href="" title="Marion ve">
          <img src="/uploads/img/loja_logo/26/d78bdd4ff51bdfb1906e8fbc40038c13.png" alt="Marion Ve">
        </a>

      </div>
      <!-- //LOGO -->

      <!-- TEXTO -->
      <div class="footer-bloco footer-texto">
        <h3>Para mas información envie un correo:</h3>
        <a href="" class="footer-email"><i class="far fa-envelope"></i> Marionvectg@gmail.com</a>
        <h4>Marion Ve &copy - 2024 - Todos los derechos reservados - by <a href="https://www.juniorjunco.com.co" target="_blank">juniorjunco</a></h4>
      </div>
      <!-- //TEXTO -->

      <!-- REDES SOCIALES -->
      <div class="footer-bloco redes-sociais">
                  
                                  <a href="https://www.instagram.com/marion.ve/" target="_blank" class="instagram" title="Instagram"><i class="fab fa-instagram"></i></a>
                      </div>
      <!-- //REDES SOCIAIS -->

    </div>
  </div>
</footer>
<!-- //FOOTER -->

<!-- GERAIS -->
<!-- VOLTAR AO TOPO -->
<div class="gotop"></div>

<!-- LOADING -->
<div class="loading">
  <div class="loading-wrap">
    <div class="loader">Aguarde...</div>
  </div>
</div>

<!-- ALERTA -->
<div class="modal" id="modal-alert">
  <div class="modal-wrap modal-sm">
    <span class="modal-btn-close modal-close" data-modal="modal-alert"></span>
    <div class="modal-header">
      <span class="modal-titulo" id="alert-titulo"></span>          
    </div>
    <div class="modal-body">
      <div class="modal-alert-icon">
        <i class="fas fa-check-circle"></i>
        <i class="fas fa-exclamation-circle"></i>
        <i class="fas fa-times-circle"></i>
      </div>
      <p class="texto" id="alert-texto"></p>
      <div class="modal-btn center">	
        <button type="button" class="btn btn-sm modal-close" data-modal="modal-alert"></button>
      </div>  
    </div>
  </div>
</div>
<!-- //ALERTA -->

<span id="infos" data-url-base=""></span>

<!-- SCRIPTS -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/aos/2.3.4/aos.js"></script>
<script src="https://www.google.com/recaptcha/api.js?onload=initRecaptcha&render=explicit" async defer></script>
<script src="/app/assets/dist/js/plugins.min.js?v=7"></script>
<script src="/app/assets/dist/js/script.min.js?v=10"></script>
<script src="/app/assets/dist/js/languageSelector.js"></script>
<script>
// Inicializar AOS
AOS.init();

// Obtener referencias a los elementos
const usernameElement = document.getElementById('username');
const logoutButton = document.getElementById('logoutButton');

// Función para decodificar el token JWT
function parseJwt(token) {
  try {
    const base64Url = token.split('.')[1];
    const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
    const jsonPayload = decodeURIComponent(atob(base64).split('').map(function(c) {
      return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
    }).join(''));
    return JSON.parse(jsonPayload);
  } catch (error) {
    return null;
  }
}

// Verificar si el token está presente
const token = localStorage.getItem('token');
if (!token) {
  // Redirigir a la página de inicio de sesión si no hay token
  window.location.href = 'index.html';
} else {
  // Decodificar el token y mostrar el nombre de usuario
  const decodedToken = parseJwt(token);
  if (decodedToken && decodedToken.username) {
    usernameElement.textContent = decodedToken.username;
  } else {
    // Redirigir a la página de inicio de sesión si el token no es válido
    window.location.href = 'index.html';
  }
}

// Manejar el cierre de sesión
logoutButton.addEventListener('click', () => {
  localStorage.removeItem('token');
  window.location.href = 'index.html';
});

// Manejar la publicación de un post
document.getElementById('postForm').addEventListener('submit', async function(e) {
  e.preventDefault();
  const title = document.getElementById('title').value;
  const content = document.getElementById('content').value;

  try {
    // Reemplazar 'http://localhost:3000' con la URL de tu backend en producción
    const response = await fetch('https://marion-backend-production.up.railway.app/posts', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'Authorization': `Bearer ${token}` // Incluir el token en el encabezado
      },
      body: JSON.stringify({ title, content })
    });

    if (response.ok) {
      alert('Post publicado exitosamente');
      document.getElementById('postForm').reset();
      fetchPosts(); // Actualizar los posts después de publicar
    } else {
      const errorData = await response.json();
      alert(`Error publicando el post: ${errorData.message}`);
    }
  } catch (error) {
    console.error('Error:', error);
  }
});

async function fetchPosts() {
  try {
    const response = await fetch('https://marion-backend-production.up.railway.app/posts');
    if (!response.ok) {
      throw new Error('Network response was not ok ' + response.statusText);
    }
    const posts = await response.json();
    const postsContainer = document.getElementById('posts');
    postsContainer.innerHTML = '';
    posts.forEach(post => {
      const postElement = document.createElement('div');
      postElement.className = 'post';
      postElement.innerHTML = `
        <div class="post-content"> 
          <h2 class="subtitulo post-title">${post.title}</h2>
          <p class="post-text">${post.content}</p>
        </div>
        <button class="edit-post" data-id="${post._id}">
          <img src="/uploads/img/icon/editar.svg" alt="Editar">
        </button>
        <button class="delete-post" data-id="${post._id}">
          <img src="/uploads/img/icon/remove.svg" alt="Eliminar">
        </button>
      `;
      postsContainer.appendChild(postElement);
    });

    // Add event listeners to delete and edit buttons
    document.querySelectorAll('.delete-post').forEach(button => {
      button.addEventListener('click', deletePost);
    });
    document.querySelectorAll('.edit-post').forEach(button => {
      button.addEventListener('click', showEditForm);
    });
  } catch (error) {
    console.error('Error fetching posts:', error);
  }
}

async function deletePost(event) {
  const postId = event.target.closest('button').dataset.id;
  const token = localStorage.getItem('token');
  try {
    const response = await fetch(`https://marion-backend-production.up.railway.app/posts/${postId}`, {
      method: 'DELETE',
      headers: {
        'Authorization': `Bearer ${token}`,
        'Content-Type': 'application/json'
      }
    });
    if (!response.ok) {
      throw new Error('Network response was not ok ' + response.statusText);
    }
    alert('Post eliminado exitosamente');
    fetchPosts(); // Refresh posts
  } catch (error) {
    console.error('Error deleting post:', error);
  }
}

function showEditForm(event) {
  const postId = event.target.closest('button').dataset.id;
  const postElement = event.target.closest('.post');
  const title = postElement.querySelector('h2').textContent;
  const content = postElement.querySelector('p').textContent;

  // Create an edit form
  const editForm = document.createElement('form');
  editForm.className = 'edit-form';
  editForm.innerHTML = `
    <input class="campo" type="text" name="title" value="${title}" required>
    <textarea class="campo" name="content" required>${content}</textarea>
    <button class="btn btn-primario" type="submit">Guardar</button>
    <button class="btn btn-primario" type="button" class="cancel-edit">Cancelar</button>
  `;
  postElement.innerHTML = '';
  postElement.appendChild(editForm);

  // Add event listener to submit the edit form
  editForm.addEventListener('submit', (e) => {
    e.preventDefault();
    editPost(postId, editForm.title.value, editForm.content.value);
  });

  // Add event listener to cancel the edit
  editForm.querySelector('.cancel-edit').addEventListener('click', () => {
    postElement.innerHTML = `
      <div class="post-content"> 
        <h2 class="post-title">${title}</h2>
        <p class="post-text">${content}</p>
      </div>
      <button class="edit-post" data-id="${postId}">
        <img src="/uploads/img/icon/editar.svg" alt="Editar">
      </button>
      <button class="delete-post" data-id="${postId}">
        <img src="/uploads/img/icon/remove.svg" alt="Eliminar">
      </button>
    `;
    postElement.querySelector('.edit-post').addEventListener('click', showEditForm);
    postElement.querySelector('.delete-post').addEventListener('click', deletePost);
  });
}

async function editPost(postId, title, content) {
  const token = localStorage.getItem('token');
  try {
    const response = await fetch(`https://marion-backend-production.up.railway.app/posts/${postId}`, {
      method: 'PUT',
      headers: {
        'Authorization': `Bearer ${token}`,
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({ title, content })
    });
    if (!response.ok) {
      throw new Error('Network response was not ok ' + response.statusText);
    }
    alert('Post actualizado exitosamente');
    fetchPosts(); // Refresh posts
  } catch (error) {
    console.error('Error updating post:', error);
  }
}

document.addEventListener('DOMContentLoaded', fetchPosts);

</script>

</body>
</html>